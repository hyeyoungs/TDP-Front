<!DOCTYPE HTML>
<html>
<head>
    <title>Title</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Ajax -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script><meta charset="UTF-8">

    <link rel="stylesheet" type="text/css" href="./assets/css/login.css">
    <script src="back.js" rel="script"></script>
    <!-- Toast CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</head>

<script>
    $(document).ready(function () {
        if (localStorage.getItem('token')) {
            location.href = "./home.html"
        }
    });



    //
    // function addBlock(title,text){
    //     let a = document.createElement("article");
    //     let h = document.createElement("H3")
    //     let t = document.createTextNode(title);
    //     h.appendChild(t);
    //     let para = document.createElement("P");
    //     para.innerHTML =text;
    //     a.appendChild(h);
    //     a.appendChild(para);
    //     document.getElementById("toast").appendChild(a);
    // }

    function cambiar_login() {
        document.querySelector('.cont_forms').className = "cont_forms cont_forms_active_login";
        document.querySelector('.cont_form_login').style.display = "block";
        document.querySelector('.cont_form_sign_up').style.opacity = "0";

        setTimeout(function () {
            document.querySelector('.cont_form_login').style.opacity = "1";
        }, 400);

        setTimeout(function () {
            document.querySelector('.cont_form_sign_up').style.display = "none";
        }, 200);

    }

    function cambiar_sign_up(at) {
        document.querySelector('.cont_forms').className = "cont_forms cont_forms_active_sign_up";
        document.querySelector('.cont_form_sign_up').style.display = "block";
        document.querySelector('.cont_form_login').style.opacity = "0";

        setTimeout(function () {
            document.querySelector('.cont_form_sign_up').style.opacity = "1";
        }, 100);

        setTimeout(function () {
            document.querySelector('.cont_form_login').style.display = "none";
        }, 400);
    }

    function ocular_login_sign_up() {

        document.querySelector('.cont_forms').className = "cont_forms";
        document.querySelector('.cont_form_sign_up').style.opacity = "0";
        document.querySelector('.cont_form_login').style.opacity = "0";


        setTimeout(function () {
            document.querySelector('.cont_form_sign_up').style.display = "none";
            document.querySelector('.cont_form_login').style.display = "none";
        }, 500);
    }

    function login() {
        let info = {
            username: $('#user_id').val(),
            password: $('#user_pw').val()
        }
        $.ajax({
            type: 'POST',
            url: `/login`,
            contentType: "application/json",
            data: JSON.stringify(info),
            success: function (response) {
                if (response) {
                    localStorage.setItem('token', response['token']);
                    localStorage.setItem('username',response['username']);
                    alert('로그인 완료!');
                    window.location.href = '/home.html';
                } else {
                    alert('error');
                }
            }
        })
    }

    function sign_up() {
        let info = {
            username: $('#sign_id').val(),
            password: $('#sign_pw').val(),
            nickname: $('#sign_nick').val(),
            password_check: $('#sign_confirm_pw').val()
        }
            $.ajax({
                type: 'POST',
                url: `/signup`,
                contentType: "application/json",
                data: JSON.stringify(info),
                success: function (response) {
                    if (response) {
                        console.log(response)
                        alert('회원가입이 완료되었습니다.');
                        window.location.href = '/';
                    } else {
                        alert('error');
                    }
                }
            })
        }
    function check_dup() {
        let user_id = $("#sign_id").val()
        let user_pw = $("#sign_pw").val()
        let user_nick = $("#sign_nick").val()
        let user_check_pw = $("#sign_confirm_pw").val()
        if (user_id === "") {
            alert("아이디를 입력해주세요")
            return
        }
        if (user_pw === "") {
            alert("비밀번호를 입력해주세요")
            return
        }
        if (user_nick === "") {
            alert("닉네임을 입력해주세요.")
            return
        }
        if(user_pw===user_check_pw){
            sign_up()
        }else{
            alert("비밀번호를 확인해주세요.")
        }
    }

    Kakao.init('0b012b5872605ba270c2c0573b61eb78');
    function kakao_login() {
        Kakao.Auth.login({

            success: function(authObj) {
                let access_token=authObj['access_token'];
                $.ajax({
                    type: 'POST',
                    url: `/login/kakao`,
                    contentType: "application/json",
                    data: JSON.stringify({'token':access_token}),
                    success: function (response) {
                        localStorage.setItem("access_token",access_token);
                        localStorage.setItem("token", response['token']);
                        localStorage.setItem("username", response['username']);
                        location.href = '/';
                    }
                })
            },
            fail: function(err) {
                alert(JSON.stringify(err))
            },
        })
    }
</script>
<body>

<div class="cotn_principal">
    <div class="cont_central">

        <div class="cont_login">

            <div class="cont_info_log_sign_up">

                <div class="col_md_login">
                    <div class="cont_ba_opcitiy">
                        <h2>LOGIN</h2>
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
                        <button class="btn_login" onclick="cambiar_login()">LOGIN</button>

                    </div>

                    <button id="login-kakao-btn" onclick="kakao_login()">
                        카카오로 로그인하기
                    </button>
                </div>


                <div class="col_md_sign_up">
                    <div class="cont_ba_opcitiy">
                        <h2>SIGN UP</h2>
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
                        <button class="btn_sign_up" onclick="cambiar_sign_up()">SIGN UP</button>
                    </div>
                </div>

            </div>


            <div class="cont_back_info">
                <div class="cont_img_back_grey">
                    <img src="https://images.unsplash.com/42/U7Fc1sy5SCUDIu4tlJY3_NY_by_PhilippHenzler_philmotion.de.jpg?ixlib=rb-0.3.5&q=50&fm=jpg&crop=entropy&s=7686972873678f32efaf2cd79671673d"
                         alt=""/>
                </div>
            </div>

            <div class="cont_forms">

                <div class="cont_img_back_">
                    <img src="https://images.unsplash.com/42/U7Fc1sy5SCUDIu4tlJY3_NY_by_PhilippHenzler_philmotion.de.jpg?ixlib=rb-0.3.5&q=50&fm=jpg&crop=entropy&s=7686972873678f32efaf2cd79671673d"
                         alt=""/>
                </div>

                <div class="cont_form_login">
                    <a href="#" onclick="ocular_login_sign_in()"><i class="material-icons">&#xE5C4;</i></a>
                    <h2>LOGIN</h2>
                    <label for="user_id"></label><input type="text" id="user_id" placeholder="ID"/>
                    <label for="user_pw"></label><input type="password" id="user_pw" placeholder="Password"/>
                    <button class="btn_login" onclick="login()">LOGIN</button>
                </div>

                <div class="cont_form_sign_up">
                    <a href="#" onclick="ocular_login_sign_up()"><i class="material-icons">&#xE5C4;</i></a>
                    <h2>SIGN UP</h2>
                    <label for="sign_id"></label><input type="text" id="sign_id" placeholder="ID"/>
                    <p id="help-id" class="help">아이디는 2-10자의 영문과 숫자와 일부 특수문자(._-)만 입력 가능합니다.</p>
                    <label for="sign_nick"></label><input type="text" id="sign_nick" placeholder="NickName"/>
                    <label for="sign_pw"></label><input type="password" id="sign_pw" placeholder="Password"/>
                    <p id="help-password" class="help">영문과 숫자 조합의 8-20자의 비밀번호를 설정해주세요. 특수문자(!@#$%^&*)도 사용 가능합니다.</p>
                    <label for="sign_confirm_pw"></label><input type="password" id="sign_confirm_pw"
                                                                placeholder="Confirm Password"/>
                    <p id="help-password2" class="help">비밀번호를 다시 한 번 입력해주세요.</p>
                    <button class="btn_sign_up" onclick="check_dup()">SIGN UP</button>
                </div>

            </div>

        </div>

    </div>
</div>


<!-- toast -->
<div class="position-fixed bottom-0 end-0 p-3 toast-box" style="z-index: 11">
    <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-delay="1000000">
        <div class="toast-header">
            <img src="..." class="rounded me-2" alt="...">
            <strong class="me-auto" id="til_title">${title}</strong>
            <small>&times;</small>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close" onclick="toast_close()"></button>
        </div>
        <div class="toast-body" id="til_content">
            ${content}
        </div>
    </div>
</div>
<!-- toast end -->

</body>
</html>